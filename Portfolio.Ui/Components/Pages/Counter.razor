@page "/counter"
@using global::Grpc.Net.Client
@using Portfolio.Grpc
@rendermode InteractiveServer

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<p>@message</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;

    private async Task IncrementCount()
    {
        await CallGrpcService(); // Use `await` for async calls.
        currentCount++;
    }

}

@code {
    private string message = "No message yet.";

    private async Task CallGrpcService()
    {
        Console.WriteLine("here!!!!!!!!!!");
        try
        {
            // The port number must match the port of the gRPC server.
            using var channel = GrpcChannel.ForAddress("http://localhost:5085");
            var client = new Greeter.GreeterClient(channel);
            var reply = await client.SayHelloAsync(new HelloRequest { Name = "GreeterClient" });
            Console.WriteLine("✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅");

            message = $"Greeting: {reply.Message}";
            Console.WriteLine(reply.Message);
        }
        catch (Exception ex)
        {
            message = $"Error: {ex.Message}";
        }
    }
}