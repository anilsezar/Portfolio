# TODO: This file needs to be developed.
---
- hosts: rpi4-blue.local
  become: true
  vars:
    nodename: rpi4-blue
  tasks:
  - name: Drain node
    local_action: "microk8s kubectl drain --ignore-daemonsets {{ nodename }}"
    
  - name: Stop MicroK8s
    ansible.builtin.command:
      cmd: "microk8s stop"
      
  - name: Reboot a slow machine that might have lots of updates to apply
    ansible.builtin.reboot:
      reboot_timeout: 3600
      msg: "Rebooting machine in 3600 as timeout"
    when: package_update_result.changed
    
  - name: Stop MicroK8s
    ansible.builtin.command:
      cmd: "microk8s start"
    
  - name: Uncordon node
    ansible.builtin.command:
      cmd: "microk8s kubectl uncordon {{ nodename }}"